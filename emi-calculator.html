<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EMI Calculator - FinTools India</title>
    <link rel="stylesheet" href="style.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    
    <!-- Google AdSense -->
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-1384260575279260"
     crossorigin="anonymous"></script>
</head>
<body>
    <!-- Professional Site Header -->
    <header class="site-header" id="siteHeader">
        <div class="header-content">
            <a href="index.html" class="site-logo">
                <h1>FinToolsIndia</h1>
                <span class="logo-subtext">Financial Planning Tools</span>
            </a>
            
            <nav class="main-navigation">
                <a href="index.html" class="nav-link">Salary Calculator</a>
                <a href="emi-calculator.html" class="nav-link active">EMI Calculator</a>
                <a href="investment-calculator.html" class="nav-link">Investment Calculator</a>
                <a href="contact.html" class="header-cta">Contact Us</a>
            </nav>
            
            <button class="mobile-menu-btn" id="mobileMenuBtn" aria-label="Toggle navigation menu">
                <i class="fas fa-bars"></i>
            </button>
            
            <nav class="mobile-nav" id="mobileNav">
                <div class="mobile-nav-links">
                    <a href="index.html" class="nav-link">Salary Calculator</a>
                    <a href="emi-calculator.html" class="nav-link active">EMI Calculator</a>
                    <a href="investment-calculator.html" class="nav-link">Investment Calculator</a>
                    <a href="contact.html" class="header-cta">Contact Us</a>
                </div>
            </nav>
        </div>
    </header>

    <div class="container">
        <!-- Page Header -->
        <div class="page-header">
            <h2>EMI Calculator</h2>
            <p>Calculate your Equated Monthly Installments (EMI) for loans and plan your finances effectively.</p>
        </div>

        <!-- Calculator Tabs Navigation -->
        <div class="calculator-tabs">
            <div class="tab-container">
                <a href="index.html" class="tab-item">
                    <i class="fas fa-calculator"></i>
                    <span>Salary Calculator</span>
                </a>
                <a href="emi-calculator.html" class="tab-item active">
                    <i class="fas fa-home"></i>
                    <span>EMI Calculator</span>
                </a>
                <a href="investment-calculator.html" class="tab-item">
                    <i class="fas fa-chart-line"></i>
                    <span>SIP Calculator</span>
                </a>
            </div>
        </div>

        <!-- Detailed Explanation Section -->
        <div class="explanation-section">
            <div class="explanation-card">
                <h3><i class="fas fa-home"></i> EMI Calculator - Plan Your Loan Repayment</h3>
                <div class="explanation-content">
                    <div class="explanation-item">
                        <div class="explanation-icon">üí≥</div>
                        <div class="explanation-text">
                            <h4>Accurate EMI Calculation</h4>
                            <p>Calculate exact monthly EMI amounts for home loans, car loans, or personal loans using precise mathematical formulas based on principal, interest rate, and tenure.</p>
                        </div>
                    </div>
                    <div class="explanation-item">
                        <div class="explanation-icon">üìà</div>
                        <div class="explanation-text">
                            <h4>Total Interest Breakdown</h4>
                            <p>See complete breakdown of total interest payable over the loan tenure and how much of your EMI goes towards principal vs interest each month.</p>
                        </div>
                    </div>
                    <div class="explanation-item">
                        <div class="explanation-icon">üè¶</div>
                        <div class="explanation-text">
                            <h4>Multiple Loan Types</h4>
                            <p>Support for Home Loans, Car Loans, Personal Loans, and Business Loans with different interest rate ranges and tenure options.</p>
                        </div>
                    </div>
                    <div class="explanation-item">
                        <div class="explanation-icon">üí°</div>
                        <div class="explanation-text">
                            <h4>Financial Planning</h4>
                            <p>Make informed decisions about loan affordability, compare different loan options, and plan your monthly budget effectively.</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="calculator-section">
            <div class="input-panel">
                <h3><i class="fas fa-calculator"></i> Enhanced Loan Calculator</h3>
                
                <!-- Basic Loan Details -->
                <div class="section-divider">
                    <h4><i class="fas fa-info-circle"></i> Basic Loan Information</h4>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label for="loanAmount">Loan Amount (‚Çπ) <span class="required">*</span></label>
                        <input type="number" id="loanAmount" placeholder="e.g., 2500000" min="1000" max="100000000">
                        <small class="help-text">Enter the principal amount you want to borrow</small>
                    </div>
                    
                    <div class="form-group">
                        <label for="loanType">Loan Type <span class="required">*</span></label>
                        <select id="loanType" onchange="updateInterestRange()">
                            <option value="home">Home Loan (6.5% - 9.5%)</option>
                            <option value="car">Car Loan (7.5% - 12%)</option>
                            <option value="personal">Personal Loan (10% - 24%)</option>
                            <option value="business">Business Loan (9% - 18%)</option>
                            <option value="education">Education Loan (8% - 12%)</option>
                        </select>
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label for="interestRate">Annual Interest Rate (%) <span class="required">*</span></label>
                        <input type="number" id="interestRate" placeholder="8.50" min="1" max="50" step="0.01">
                        <div class="interest-range">
                            <span class="range-text">Typical range: <span id="rateRange">6.5% - 9.5%</span></span>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label for="loanTenure">Loan Tenure (Years) <span class="required">*</span></label>
                        <input type="number" id="loanTenure" placeholder="15" min="1" max="40">
                        <small class="help-text">Maximum tenure varies by loan type</small>
                    </div>
                </div>

                <!-- Advanced Options -->
                <div class="section-divider">
                    <h4><i class="fas fa-cogs"></i> Advanced Options</h4>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label for="processingFee">Processing Fee (‚Çπ)</label>
                        <input type="number" id="processingFee" placeholder="25000" min="0">
                        <small class="help-text">One-time fee charged by the bank</small>
                    </div>
                    
                    <div class="form-group">
                        <label for="downPayment">Down Payment (‚Çπ)</label>
                        <input type="number" id="downPayment" placeholder="500000" min="0">
                        <small class="help-text">Amount you pay upfront</small>
                    </div>
                </div>

                <!-- Income Information -->
                <div class="section-divider">
                    <h4><i class="fas fa-rupee-sign"></i> Income Information (Optional)</h4>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label for="monthlyIncome">Monthly Income (‚Çπ)</label>
                        <input type="number" id="monthlyIncome" placeholder="75000" min="0">
                        <small class="help-text">For affordability analysis</small>
                    </div>
                    
                    <div class="form-group">
                        <label for="existingEMIs">Existing EMIs (‚Çπ)</label>
                        <input type="number" id="existingEMIs" placeholder="15000" min="0">
                        <small class="help-text">Current EMI commitments</small>
                    </div>
                </div>

                <!-- Prepayment Options -->
                <div class="section-divider">
                    <h4><i class="fas fa-fast-forward"></i> Prepayment Analysis</h4>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label for="prepaymentType">Prepayment Type</label>
                        <select id="prepaymentType">
                            <option value="none">No Prepayment</option>
                            <option value="monthly">Monthly Extra Payment</option>
                            <option value="yearly">Yearly Lump Sum</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="prepaymentAmount">Extra Payment (‚Çπ)</label>
                        <input type="number" id="prepaymentAmount" placeholder="5000" min="0">
                        <small class="help-text">Additional amount towards principal</small>
                    </div>
                </div>

                <button onclick="calculateAdvancedEMI()" class="calculate-btn enhanced">
                    <i class="fas fa-chart-line"></i> Calculate Advanced EMI
                </button>
            </div>

            <div class="results-panel">
                <h2><i class="fas fa-chart-line"></i> Comprehensive EMI Analysis</h2>
                
                <!-- EMI Summary Cards -->
                <div class="results-grid">
                    <div class="result-card highlight primary">
                        <div class="card-header">
                            <i class="fas fa-calendar-check"></i>
                            <h3>Monthly EMI</h3>
                        </div>
                        <div class="card-value">
                            <span id="emiAmount">‚Çπ0</span>
                        </div>
                        <div class="card-subtext">
                            <span id="emiToIncomeRatio">--% of monthly income</span>
                        </div>
                        <div class="emi-breakdown" id="emiBreakdown" style="display:none;">
                            <div class="breakdown-item mini">
                                <span>Principal:</span>
                                <span id="currentPrincipalAmount">‚Çπ0</span>
                            </div>
                            <div class="breakdown-item mini">
                                <span>Interest:</span>
                                <span id="currentInterestAmount">‚Çπ0</span>
                            </div>
                        </div>
                    </div>

                    <div class="result-card">
                        <div class="card-header">
                            <i class="fas fa-rupee-sign"></i>
                            <h3>Total Interest</h3>
                        </div>
                        <div class="card-value">
                            <span id="totalInterest">‚Çπ0</span>
                        </div>
                        <div class="card-subtext">
                            <span id="interestPercentage">--% of loan amount</span>
                        </div>
                    </div>

                    <div class="result-card">
                        <div class="card-header">
                            <i class="fas fa-calculator"></i>
                            <h3>Total Payment</h3>
                        </div>
                        <div class="card-value">
                            <span id="totalAmount">‚Çπ0</span>
                        </div>
                        <div class="card-subtext">
                            <span id="totalCostBreakdown">Principal + Interest + Fees</span>
                        </div>
                    </div>

                    <div class="result-card">
                        <div class="card-header">
                            <i class="fas fa-piggy-bank"></i>
                            <h3>Prepayment Savings</h3>
                        </div>
                        <div class="card-value">
                            <span id="prepaymentSavings">‚Çπ0</span>
                        </div>
                        <div class="card-subtext">
                            <span id="tenureReduction">-- months saved</span>
                        </div>
                    </div>
                </div>

                <!-- Detailed Breakdown -->
                <div class="detailed-breakdown">
                    <div class="breakdown-section">
                        <h4><i class="fas fa-list-alt"></i> Loan Details</h4>
                        <div class="breakdown-grid">
                            <div class="breakdown-item">
                                <span>Principal Amount:</span>
                                <span id="principalAmount">‚Çπ0</span>
                            </div>
                            <div class="breakdown-item">
                                <span>Processing Fee:</span>
                                <span id="displayProcessingFee">‚Çπ0</span>
                            </div>
                            <div class="breakdown-item">
                                <span>Down Payment:</span>
                                <span id="displayDownPayment">‚Çπ0</span>
                            </div>
                            <div class="breakdown-item">
                                <span>Loan Tenure:</span>
                                <span id="displayTenure">-- years</span>
                            </div>
                            <div class="breakdown-item">
                                <span>Interest Rate:</span>
                                <span id="displayInterestRate">--%</span>
                            </div>
                            <div class="breakdown-item">
                                <span>First EMI Date:</span>
                                <span id="firstEMIDate">--</span>
                            </div>
                            <div class="breakdown-item highlight">
                                <span>First Month Split:</span>
                                <span id="firstMonthSplit">Principal: ‚Çπ0 | Interest: ‚Çπ0</span>
                            </div>
                            <div class="breakdown-item">
                                <span>Interest Reduces Over Time:</span>
                                <span style="color: #28a745; font-size: 0.85em;">More principal, less interest each month</span>
                            </div>
                        </div>
                    </div>

                    <!-- Affordability Analysis -->
                    <div class="breakdown-section" id="affordabilitySection" style="display:none;">
                        <h4><i class="fas fa-chart-pie"></i> Affordability Analysis</h4>
                        <div class="affordability-meter">
                            <div class="meter-container">
                                <div class="meter-bar">
                                    <div class="meter-fill" id="affordabilityMeter"></div>
                                </div>
                                <span class="meter-text" id="affordabilityText">Calculating...</span>
                            </div>
                            <div class="affordability-details">
                                <div class="breakdown-item">
                                    <span>Monthly Income:</span>
                                    <span id="displayMonthlyIncome">‚Çπ0</span>
                                </div>
                                <div class="breakdown-item">
                                    <span>Existing EMIs:</span>
                                    <span id="displayExistingEMIs">‚Çπ0</span>
                                </div>
                                <div class="breakdown-item">
                                    <span>Available for EMI:</span>
                                    <span id="availableForEMI">‚Çπ0</span>
                                </div>
                                <div class="breakdown-item highlight">
                                    <span>Loan Eligibility:</span>
                                    <span id="loanEligibility">‚Çπ0</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Amortization Preview -->
                <div class="amortization-section">
                    <h4><i class="fas fa-table"></i> Payment Schedule Preview</h4>
                    <div class="amortization-preview">
                        <div class="schedule-tabs">
                            <button class="schedule-tab active" onclick="showScheduleView('yearly')">Yearly View</button>
                            <button class="schedule-tab" onclick="showScheduleView('monthly')">Monthly View</button>
                        </div>
                        <div class="schedule-container">
                            <div id="yearlySchedule" class="schedule-content active">
                                <div class="schedule-header">
                                    <span>Year</span>
                                    <span>Principal (% of Year)</span>
                                    <span>Interest (% of Year)</span>
                                    <span>Balance</span>
                                </div>
                                <div id="yearlyScheduleBody" class="schedule-body">
                                    <!-- Yearly schedule will be populated here -->
                                </div>
                            </div>
                            <div id="monthlySchedule" class="schedule-content">
                                <div class="schedule-header">
                                    <span>Month</span>
                                    <span>EMI</span>
                                    <span>Principal (% of EMI)</span>
                                    <span>Interest (% of EMI)</span>
                                    <span>Balance</span>
                                </div>
                                <div id="monthlyScheduleBody" class="schedule-body">
                                    <!-- Monthly schedule will be populated here -->
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Action Buttons -->
                <div class="action-buttons">
                    <button onclick="downloadEMISchedule()" class="action-btn secondary">
                        <i class="fas fa-download"></i> Download Schedule
                    </button>
                    <button onclick="showComparison()" class="action-btn primary">
                        <i class="fas fa-balance-scale"></i> Compare Loans
                    </button>
                    <button onclick="emailResults()" class="action-btn secondary">
                        <i class="fas fa-envelope"></i> Email Results
                    </button>
                </div>
            </div>
        </div>

        <div style="text-align: center; margin: 30px 0;">
            <a href="index.html" style="color: #667eea; text-decoration: none; font-weight: 500;">
                ‚Üê Back to Salary Calculator
            </a>
        </div>

        <footer>
            <p>
                <i class="fas fa-info-circle"></i>
                This calculator provides approximate values. Please consult a financial advisor for accurate planning.
            </p>
            <div class="footer-links">
                <a href="privacy.html">Privacy Policy</a> |
                <a href="terms.html">Terms of Service</a>
            </div>
            <div class="footer-brand">
                <strong>FinToolsIndia</strong> - Professional Financial Calculators for India
            </div>
        </footer>
    </div>

    <script>
        // Enhanced EMI Calculator with Advanced Features
        
        function updateInterestRange() {
            const loanType = document.getElementById('loanType').value;
            const rateRange = document.getElementById('rateRange');
            const interestInput = document.getElementById('interestRate');
            
            const ranges = {
                'home': { range: '6.5% - 9.5%', suggested: 8.5 },
                'car': { range: '7.5% - 12%', suggested: 9.5 },
                'personal': { range: '10% - 24%', suggested: 15.0 },
                'business': { range: '9% - 18%', suggested: 12.0 },
                'education': { range: '8% - 12%', suggested: 10.0 }
            };
            
            const typeData = ranges[loanType];
            rateRange.textContent = typeData.range;
            interestInput.placeholder = typeData.suggested.toString();
        }

        function calculateAdvancedEMI() {
            // Get all input values
            const loanAmount = parseFloat(document.getElementById('loanAmount').value);
            const interestRate = parseFloat(document.getElementById('interestRate').value);
            const tenure = parseFloat(document.getElementById('loanTenure').value);
            const processingFee = parseFloat(document.getElementById('processingFee').value) || 0;
            const downPayment = parseFloat(document.getElementById('downPayment').value) || 0;
            const monthlyIncome = parseFloat(document.getElementById('monthlyIncome').value) || 0;
            const existingEMIs = parseFloat(document.getElementById('existingEMIs').value) || 0;
            const prepaymentType = document.getElementById('prepaymentType').value;
            const prepaymentAmount = parseFloat(document.getElementById('prepaymentAmount').value) || 0;

            // Validation
            if (!loanAmount || !interestRate || !tenure) {
                alert('Please fill in the required fields: Loan Amount, Interest Rate, and Tenure');
                return;
            }

            // Calculate basic EMI
            const actualLoanAmount = loanAmount - downPayment;
            const monthlyRate = interestRate / 12 / 100;
            const totalMonths = tenure * 12;

            const emi = (actualLoanAmount * monthlyRate * Math.pow(1 + monthlyRate, totalMonths)) / 
                       (Math.pow(1 + monthlyRate, totalMonths) - 1);

            const totalPayment = emi * totalMonths;
            const totalInterest = totalPayment - actualLoanAmount;
            const totalCost = totalPayment + processingFee + downPayment;

            // Calculate prepayment savings
            let prepaymentSavings = 0;
            let reducedTenure = totalMonths;
            
            if (prepaymentType !== 'none' && prepaymentAmount > 0) {
                const savings = calculatePrepaymentSavings(actualLoanAmount, monthlyRate, totalMonths, prepaymentAmount, prepaymentType);
                prepaymentSavings = savings.interestSaved;
                reducedTenure = savings.newTenure;
            }

            // Update all displays
            updateBasicResults(emi, actualLoanAmount, totalInterest, totalCost, prepaymentSavings, reducedTenure);
            updateLoanDetails(actualLoanAmount, processingFee, downPayment, tenure, interestRate);
            
            if (monthlyIncome > 0) {
                updateAffordabilityAnalysis(emi, monthlyIncome, existingEMIs, interestRate);
            }
            
            generateAmortizationSchedule(actualLoanAmount, monthlyRate, totalMonths, emi);
        }

        function updateBasicResults(emi, principal, totalInterest, totalCost, savings, reducedTenure) {
            document.getElementById('emiAmount').textContent = formatCurrency(emi);
            document.getElementById('totalInterest').textContent = formatCurrency(totalInterest);
            document.getElementById('totalAmount').textContent = formatCurrency(totalCost);
            document.getElementById('prepaymentSavings').textContent = formatCurrency(savings);
            
            const monthsSaved = parseFloat(document.getElementById('loanTenure').value) * 12 - reducedTenure;
            document.getElementById('tenureReduction').textContent = `${Math.round(monthsSaved)} months saved`;
            
            const interestPercentage = ((totalInterest / principal) * 100).toFixed(1);
            document.getElementById('interestPercentage').textContent = `${interestPercentage}% of loan amount`;
            
            const monthlyIncome = parseFloat(document.getElementById('monthlyIncome').value) || 0;
            if (monthlyIncome > 0) {
                const ratio = ((emi / monthlyIncome) * 100).toFixed(1);
                document.getElementById('emiToIncomeRatio').textContent = `${ratio}% of monthly income`;
            }
            
            // Calculate first month's principal and interest breakdown
            const interestRate = parseFloat(document.getElementById('interestRate').value);
            const monthlyRate = interestRate / 12 / 100;
            const firstMonthInterest = principal * monthlyRate;
            const firstMonthPrincipal = emi - firstMonthInterest;
            
            // Show EMI breakdown
            document.getElementById('currentPrincipalAmount').textContent = formatCurrency(firstMonthPrincipal);
            document.getElementById('currentInterestAmount').textContent = formatCurrency(firstMonthInterest);
            document.getElementById('emiBreakdown').style.display = 'block';
        }

        function updateLoanDetails(principal, fee, downPayment, tenure, rate) {
            document.getElementById('principalAmount').textContent = formatCurrency(principal);
            document.getElementById('displayProcessingFee').textContent = formatCurrency(fee);
            document.getElementById('displayDownPayment').textContent = formatCurrency(downPayment);
            document.getElementById('displayTenure').textContent = `${tenure} years`;
            document.getElementById('displayInterestRate').textContent = `${rate}%`;
            
            // Calculate first EMI date (next month)
            const today = new Date();
            const firstEMI = new Date(today.getFullYear(), today.getMonth() + 1, today.getDate());
            document.getElementById('firstEMIDate').textContent = firstEMI.toLocaleDateString('en-IN');
            
            // Calculate first month breakdown
            const monthlyRate = rate / 12 / 100;
            const totalMonths = tenure * 12;
            const emi = (principal * monthlyRate * Math.pow(1 + monthlyRate, totalMonths)) / 
                       (Math.pow(1 + monthlyRate, totalMonths) - 1);
            
            const firstMonthInterest = principal * monthlyRate;
            const firstMonthPrincipal = emi - firstMonthInterest;
            
            document.getElementById('firstMonthSplit').textContent = 
                `Principal: ${formatCurrency(firstMonthPrincipal)} | Interest: ${formatCurrency(firstMonthInterest)}`;
        }

        function updateAffordabilityAnalysis(emi, monthlyIncome, existingEMIs, interestRate) {
            const section = document.getElementById('affordabilitySection');
            section.style.display = 'block';
            
            document.getElementById('displayMonthlyIncome').textContent = formatCurrency(monthlyIncome);
            document.getElementById('displayExistingEMIs').textContent = formatCurrency(existingEMIs);
            
            const totalEMIs = emi + existingEMIs;
            const emiRatio = (totalEMIs / monthlyIncome) * 100;
            const availableForEMI = monthlyIncome * 0.5; // 50% of income is safe for EMIs
            
            document.getElementById('availableForEMI').textContent = formatCurrency(availableForEMI);
            
            // Calculate loan eligibility (max loan for 50% EMI ratio)
            const maxEMI = availableForEMI - existingEMIs;
            const monthlyRate = interestRate / 12 / 100;
            const tenure = parseFloat(document.getElementById('loanTenure').value) * 12;
            const eligibleLoan = (maxEMI * (Math.pow(1 + monthlyRate, tenure) - 1)) / 
                               (monthlyRate * Math.pow(1 + monthlyRate, tenure));
            
            document.getElementById('loanEligibility').textContent = formatCurrency(Math.max(0, eligibleLoan));
            
            // Update affordability meter
            updateAffordabilityMeter(emiRatio);
        }

        function updateAffordabilityMeter(emiRatio) {
            const meter = document.getElementById('affordabilityMeter');
            const text = document.getElementById('affordabilityText');
            
            let status, width, className;
            
            if (emiRatio <= 30) {
                status = 'Excellent - Very Affordable';
                width = Math.min(emiRatio * 3.33, 100);
                className = 'excellent';
            } else if (emiRatio <= 40) {
                status = 'Good - Affordable';
                width = Math.min(emiRatio * 2.5, 100);
                className = 'good';
            } else if (emiRatio <= 50) {
                status = 'Fair - Manageable';
                width = Math.min(emiRatio * 2, 100);
                className = 'fair';
            } else {
                status = 'Poor - High Risk';
                width = 100;
                className = 'poor';
            }
            
            meter.style.width = width + '%';
            meter.className = `meter-fill ${className}`;
            text.textContent = `${emiRatio.toFixed(1)}% - ${status}`;
        }

        function calculatePrepaymentSavings(principal, monthlyRate, totalMonths, prepaymentAmount, prepaymentType) {
            // Simplified prepayment calculation
            let remainingPrincipal = principal;
            let totalInterestPaid = 0;
            let month = 1;
            
            const regularEMI = (principal * monthlyRate * Math.pow(1 + monthlyRate, totalMonths)) / 
                              (Math.pow(1 + monthlyRate, totalMonths) - 1);
            
            while (remainingPrincipal > 1 && month <= totalMonths) {
                const interestPayment = remainingPrincipal * monthlyRate;
                const principalPayment = regularEMI - interestPayment;
                
                totalInterestPaid += interestPayment;
                remainingPrincipal -= principalPayment;
                
                // Add prepayment
                if (prepaymentType === 'monthly' || (prepaymentType === 'yearly' && month % 12 === 0)) {
                    remainingPrincipal = Math.max(0, remainingPrincipal - prepaymentAmount);
                }
                
                month++;
            }
            
            const originalInterest = (regularEMI * totalMonths) - principal;
            const interestSaved = originalInterest - totalInterestPaid;
            
            return {
                interestSaved: Math.max(0, interestSaved),
                newTenure: month - 1
            };
        }

        function generateAmortizationSchedule(principal, monthlyRate, totalMonths, emi) {
            const yearlyScheduleBody = document.getElementById('yearlyScheduleBody');
            const monthlyScheduleBody = document.getElementById('monthlyScheduleBody');
            
            yearlyScheduleBody.innerHTML = '';
            monthlyScheduleBody.innerHTML = '';
            
            let remainingPrincipal = principal;
            let yearlyPrincipal = 0;
            let yearlyInterest = 0;
            let cumulativeInterest = 0;
            let cumulativePrincipal = 0;
            
            // Show more months initially (24 months = 2 years)
            const monthsToShow = Math.min(24, totalMonths);
            
            for (let month = 1; month <= Math.min(totalMonths, 240); month++) { // Limit to 20 years for performance
                const interestPayment = remainingPrincipal * monthlyRate;
                const principalPayment = Math.min(emi - interestPayment, remainingPrincipal);
                remainingPrincipal -= principalPayment;
                
                cumulativeInterest += interestPayment;
                cumulativePrincipal += principalPayment;
                
                yearlyPrincipal += principalPayment;
                yearlyInterest += interestPayment;
                
                // Add monthly row (show first 24 months)
                if (month <= monthsToShow) {
                    const monthRow = document.createElement('div');
                    monthRow.className = 'schedule-row monthly';
                    
                    const principalPercentage = ((principalPayment / emi) * 100).toFixed(1);
                    const interestPercentage = ((interestPayment / emi) * 100).toFixed(1);
                    
                    monthRow.innerHTML = `
                        <span>Month ${month}</span>
                        <span>${formatCurrency(emi)}</span>
                        <span>${formatCurrency(principalPayment)} <small>(${principalPercentage}%)</small></span>
                        <span>${formatCurrency(interestPayment)} <small>(${interestPercentage}%)</small></span>
                        <span>${formatCurrency(remainingPrincipal)}</span>
                    `;
                    monthlyScheduleBody.appendChild(monthRow);
                }
                
                // Add yearly summary
                if (month % 12 === 0 || remainingPrincipal <= 0) {
                    const year = Math.ceil(month / 12);
                    const yearRow = document.createElement('div');
                    yearRow.className = 'schedule-row';
                    
                    const yearlyTotal = yearlyPrincipal + yearlyInterest;
                    const yearPrincipalPercent = yearlyTotal > 0 ? ((yearlyPrincipal / yearlyTotal) * 100).toFixed(1) : 0;
                    const yearInterestPercent = yearlyTotal > 0 ? ((yearlyInterest / yearlyTotal) * 100).toFixed(1) : 0;
                    
                    yearRow.innerHTML = `
                        <span>Year ${year}</span>
                        <span>${formatCurrency(yearlyPrincipal)} <small>(${yearPrincipalPercent}%)</small></span>
                        <span>${formatCurrency(yearlyInterest)} <small>(${yearInterestPercent}%)</small></span>
                        <span>${formatCurrency(remainingPrincipal)}</span>
                    `;
                    yearlyScheduleBody.appendChild(yearRow);
                    
                    yearlyPrincipal = 0;
                    yearlyInterest = 0;
                }
                
                if (remainingPrincipal <= 0) break;
            }
            
            // Add summary information
            if (monthsToShow < totalMonths) {
                const summaryRow = document.createElement('div');
                summaryRow.className = 'schedule-row summary';
                summaryRow.innerHTML = `
                    <span style="grid-column: 1 / -1; text-align: center; font-style: italic; color: #666;">
                        Showing first ${monthsToShow} months. Total loan tenure: ${Math.ceil(totalMonths/12)} years (${totalMonths} months)
                    </span>
                `;
                monthlyScheduleBody.appendChild(summaryRow);
            }
        }

        function showScheduleView(viewType) {
            // Update tab active state
            document.querySelectorAll('.schedule-tab').forEach(tab => tab.classList.remove('active'));
            event.target.classList.add('active');
            
            // Show/hide schedule content
            document.querySelectorAll('.schedule-content').forEach(content => content.classList.remove('active'));
            document.getElementById(viewType + 'Schedule').classList.add('active');
            
            // Update header for monthly view
            const header = document.querySelector(`#${viewType}Schedule .schedule-header`);
            if (viewType === 'monthly') {
                header.classList.add('monthly');
            } else {
                header.classList.remove('monthly');
            }
        }

        function downloadEMISchedule() {
            // Create downloadable content
            const loanAmount = document.getElementById('loanAmount').value;
            const interestRate = document.getElementById('interestRate').value;
            const tenure = document.getElementById('loanTenure').value;
            const emi = document.getElementById('emiAmount').textContent;
            
            const content = `EMI Calculator Results\n\n` +
                          `Loan Amount: ‚Çπ${loanAmount}\n` +
                          `Interest Rate: ${interestRate}%\n` +
                          `Tenure: ${tenure} years\n` +
                          `Monthly EMI: ${emi}\n\n` +
                          `Generated by FinToolsIndia.com\n` +
                          `Date: ${new Date().toLocaleDateString('en-IN')}`;
            
            const blob = new Blob([content], { type: 'text/plain' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'EMI-Schedule-FinToolsIndia.txt';
            a.click();
            URL.revokeObjectURL(url);
        }

        function showComparison() {
            alert('Loan comparison feature coming soon! This will allow you to compare multiple loan options side by side.');
        }

        function emailResults() {
            const emi = document.getElementById('emiAmount').textContent;
            const total = document.getElementById('totalAmount').textContent;
            
            const subject = 'My EMI Calculation Results - FinToolsIndia';
            const body = `Here are my EMI calculation results:\n\n` +
                        `Monthly EMI: ${emi}\n` +
                        `Total Payment: ${total}\n\n` +
                        `Calculated using FinToolsIndia.com`;
            
            window.open(`mailto:?subject=${encodeURIComponent(subject)}&body=${encodeURIComponent(body)}`);
        }

        function formatCurrency(amount) {
            return new Intl.NumberFormat('en-IN', {
                style: 'currency',
                currency: 'INR',
                maximumFractionDigits: 0
            }).format(amount);
        }

        // Initialize on page load
        document.addEventListener('DOMContentLoaded', function() {
            updateInterestRange();
        });
    </script>

    <!-- Header JavaScript -->
    <script>
        // Mobile menu toggle
        const mobileMenuBtn = document.getElementById('mobileMenuBtn');
        const mobileNav = document.getElementById('mobileNav');
        
        mobileMenuBtn.addEventListener('click', () => {
            mobileNav.classList.toggle('open');
            const icon = mobileMenuBtn.querySelector('i');
            icon.className = mobileNav.classList.contains('open') ? 'fas fa-times' : 'fas fa-bars';
        });
        
        // Header scroll effect
        const siteHeader = document.getElementById('siteHeader');
        let lastScrollTop = 0;
        
        window.addEventListener('scroll', () => {
            const scrollTop = window.pageYOffset || document.documentElement.scrollTop;
            
            if (scrollTop > 10) {
                siteHeader.classList.add('scrolled');
            } else {
                siteHeader.classList.remove('scrolled');
            }
            
            lastScrollTop = scrollTop;
        });
        
        // Close mobile menu when clicking outside
        document.addEventListener('click', (e) => {
            if (!e.target.closest('.site-header')) {
                mobileNav.classList.remove('open');
                const icon = mobileMenuBtn.querySelector('i');
                icon.className = 'fas fa-bars';
            }
        });
    </script>

        <!-- Professional Black Footer -->
        <footer class="professional-footer">
            <div class="footer-content">
                <div class="footer-main">
                    <div class="footer-brand-section">
                        <h3 class="footer-brand-title">FinToolsIndia</h3>
                        <p class="footer-brand-subtitle">Professional Financial Calculators for India</p>
                        <p class="footer-disclaimer">
                            <i class="fas fa-info-circle"></i>
                            This calculator provides approximate values based on current Indian tax laws. 
                            Please consult a tax advisor for accurate calculations.
                        </p>
                    </div>
                    
                    <div class="footer-navigation">
                        <div class="footer-column">
                            <h4>Calculators</h4>
                            <ul>
                                <li><a href="index.html">Salary Calculator</a></li>
                                <li><a href="emi-calculator.html">EMI Calculator</a></li>
                                <li><a href="investment-calculator.html">Investment Calculator</a></li>
                            </ul>
                        </div>
                        
                        <div class="footer-column">
                            <h4>Legal</h4>
                            <ul>
                                <li><a href="privacy.html">Privacy Policy</a></li>
                                <li><a href="terms.html">Terms of Service</a></li>
                                <li><a href="contact.html">Contact Us</a></li>
                            </ul>
                        </div>
                        
                        <div class="footer-column">
                            <h4>Resources</h4>
                            <ul>
                                <li><a href="#">Tax Guide FY 2026-27</a></li>
                                <li><a href="#">Salary Planning Tips</a></li>
                                <li><a href="#">Investment Strategies</a></li>
                            </ul>
                        </div>
                    </div>
                </div>
                
                <div class="footer-bottom">
                    <div class="footer-copyright">
                        <p>&copy; 2026 FinToolsIndia. All rights reserved.</p>
                    </div>
                    <div class="footer-social">
                        <p>Trusted by thousands of professionals across India</p>
                    </div>
                </div>
            </div>
        </footer>
    </div>
</body>
</html>
